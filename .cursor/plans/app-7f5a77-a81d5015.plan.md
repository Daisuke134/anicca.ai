<!-- a81d5015-3f3f-423d-a3df-5c1e5d9ab8ca 89541508-8d1e-4710-8f56-9dbe6a215f42 -->
# App Review Compliance – iOS 1.0 (Final)

## Reject Sentence 

Review Environment

Submission ID: cd710420-af80-4b5b-964a-e389b14fe8cb

Review date: November 25, 2025

Version reviewed: 1.0

Guideline 2.1 - Performance - App Completeness

Issue Description

The app exhibited one or more bugs that would negatively impact users.

Bug description: Aniccaと話す feature did not load properly and finish instantly.

Review device details:

- Device type: iPad Air (5th generation) 
- OS version: iPadOS 26.1

Next Steps

Test the app on supported devices to identify and resolve bugs and stability issues before submitting for review.

If the bug cannot be reproduced, try the following:

- For new apps, uninstall all previous versions of the app from a device, then install and follow the steps to reproduce.
- For app updates, install the new version as an update to the previous version, then follow the steps to reproduce.

Resources

- For information about testing apps and preparing them for review, see Testing a Release Build.
- To learn about troubleshooting networking issues, see Networking Overview.

Guideline 2.1 - Performance - App Completeness

We found that your in-app purchase products exhibited one or more bugs which create a poor user experience.

Specifically, Subscription information not displayed if users did not sign up during tutorial. Please review the details and resources below and complete the next steps.

Review device details:

- Device type: iPad Air (5th generation) 
- OS version: iPadOS 26.1

Next Steps

When validating receipts on your server, your server needs to be able to handle a production-signed app getting its receipts from Apple’s test environment. The recommended approach is for your production server to always validate receipts against the production App Store first. If validation fails with the error code "Sandbox receipt used in production," you should validate against the test environment instead.

Resources

- Note that in-app purchases do not need to have been previously approved to confirm they function correctly in review.
- Note that the Account Holder must accept the Paid Apps Agreement in the Business section of App Store Connect before paid in-app purchases will function.
- Learn how to set up and test in-app purchase products in the sandbox environment.
- Learn more about validating receipts with the App Store.

Guideline 3.1.2 - Business - Payments - Subscriptions

Issue Description

The submission did not include all the required information for apps offering auto-renewable subscriptions.

The app's metadata is missing the following required information:

- A functional link to the Terms of Use (EULA). If you are using the standard Apple Terms of Use (EULA), include a link to the Terms of Use in the App Description. If you are using a custom EULA, add it in App Store Connect.

Next Steps

Update the metadata to include the information specified above.

Resources

Apps offering auto-renewable subscriptions must include all of the following required information in the binary:

- Title of auto-renewing subscription (this may be the same as the in-app purchase product name)
- Length of subscription
- Price of subscription, and price per unit if appropriate
- Functional links to the privacy policy and Terms of Use (EULA)

The app metadata must also include functional links to the privacy policy in the Privacy Policy field in App Store Connect and the Terms of Use (EULA) in the App Description or EULA field in App Store Connect.

Review Schedule 2 of the Apple Developer Program License Agreement to learn more.

Guideline 3.1.2 - Business - Payments - Subscriptions

We noticed that one or more of your auto-renewable subscriptions is marketed in the purchase flow in a manner that may mislead or confuse users about the subscription terms or pricing. Specifically:

 - Your auto-renewable subscription displays the monthly calculated pricing for your subscription more clearly and conspicuously than the billed amount.

Next Steps

Please revise your auto-renewable subscription purchase flow to ensure that the billed amount is the most clear and conspicuous pricing element in the layout. Any other pricing elements, including free trial, introductory pricing, and calculated pricing information, must be displayed in a subordinate position and size to the total billed amount. Factors that contribute to whether the billed amount is clear and conspicuous include, but are not limited to, the font, size, color, and location of the billed amount in the auto-renewable subscription purchase flow.

Resources

- See design guidance for auto-renewable subscriptions in the Human Interface Guidelines, including how to create a positive onboarding experience. 
- Learn more about offering auto-renewable subscriptions in your app.

## Overview

Align the app with Apple Guidelines 2.1 and 3.1.2 using official best practices only. Implement microphone permission preflight on iPadOS 26.1+, keep subscription discovery via Settings only (no new main‑screen CTA), ensure metadata/EULA and IAP info are present, and verify billed‑amount prominence on the RevenueCat paywall.

## Changes To Implement (Minimal, Official)

### A. Fix “finish instantly” on iPad – Microphone permission preflight

- Where: `aniccaios/aniccaios/SessionView.swift`
- Goal: Before starting a realtime session, handle 3 states explicitly: Undetermined → system prompt; Denied → alert with Settings deep link; Granted → start.

Proposed code (add to SessionView):

```swift
@State private var showMicAlert = false

private func ensureMicrophonePermissionAndStart() {
    if #available(iOS 17.0, *) {
        switch AVAudioApplication.shared.recordPermission {
        case .granted:
            controller.start()
        case .undetermined:
            AVAudioApplication.requestRecordPermission { granted in
                DispatchQueue.main.async { granted ? controller.start() : (showMicAlert = true) }
            }
        default:
            showMicAlert = true
        }
    } else {
        switch AVAudioSession.sharedInstance().recordPermission {
        case .granted:
            controller.start()
        case .undetermined:
            AVAudioSession.sharedInstance().requestRecordPermission { granted in
                DispatchQueue.main.async { granted ? controller.start() : (showMicAlert = true) }
            }
        default:
            showMicAlert = true
        }
    }
}

// Replace button action: controller.start() → ensureMicrophonePermissionAndStart()
// Add alert:
.alert("マイクのアクセスが必要です", isPresented: $showMicAlert) {
    Button(String(localized: "common_open_settings")) {
        if let url = URL(string: UIApplication.openSettingsURLString) { UIApplication.shared.open(url) }
    }
    Button(String(localized: "common_cancel"), role: .cancel) {}
} message: {
    Text("Aniccaはリアルタイム会話にマイクを使用します。設定アプリで許可してください。")
}
```

Notes:

- This prevents “finish instantly” and clearly explains the next action.
- No UI/UX deviations from Apple guidance; we only add standard permission handling.

### B. Keep subscription discovery via Settings only (no new CTA)

- No main‑screen “See Plan” button will be added. Discovery is via Settings > Plan and automatic paywall when free quota is reached.

### C. (Optional, defensive) Settings usage placeholder

- Where: `SettingsView` near usage lines. Show a small placeholder while usage sync is pending to avoid reviewer confusion.
```swift
if appState.subscriptionInfo.monthlyUsageCount == nil || appState.subscriptionInfo.monthlyUsageLimit == nil {
    Text("同期中…（サブスクリプション情報はまもなく表示されます）")
        .font(.footnote)
        .foregroundStyle(.secondary)
}
```


## App Store Connect / IAP Tasks (Official Only)

- Description (all locales):
  - Include links:
    - Privacy Policy: https://aniccaai.com/privacy
    - Terms of Use (EULA): https://www.apple.com/legal/internet-services/itunes/dev/stdeula/
- App Information:
  - Privacy Policy URL set to https://aniccaai.com/privacy
  - Paid Apps Agreement accepted
- Each auto‑renewable IAP:
  - Localized Display Name & Description
  - Subscription Duration (Monthly / Annual)
  - Price schedule
  - Subscription Group assigned
  - Review Screenshot attached
  - State = Ready to Submit
- Paywall (in‑app):
  - RevenueCat standard UI; billed amount is the most conspicuous element
  - Legal links reachable from paywall (already via `LegalLinksView`)
  - Restore Purchases available

IAP Description copy (for convenience):

- Japanese:

"自動更新サブスクリプションです。期間は1か月（または1年）です。お支払いは購入確定時にApple IDに請求されます。キャンセル/管理は 設定 > Apple ID > サブスクリプション から。現在の期間が終了する24時間前までにオフにしない限り自動更新されます。価格は購入画面の金額が適用され、国/通貨により異なる場合があります。プライバシーポリシー: https://aniccaai.com/privacy 利用規約(EULA): https://www.apple.com/legal/internet-services/itunes/dev/stdeula/"

- English:

"This is an auto‑renewing subscription. Length: 1 month (or 1 year). Payment will be charged to your Apple ID at confirmation of purchase. Manage/Cancel in Settings > Apple ID > Subscriptions. Renews unless turned off at least 24 hours before the end of the period. Price shown on the purchase screen applies and may vary by region/currency. Privacy Policy: https://aniccaai.com/privacy Terms of Use (EULA): https://www.apple.com/legal/internet-services/itunes/dev/stdeula/"

## Test Matrix (Must pass on iPad Air 5 / iPadOS 26.1)

- Mic permission states:
  - Undetermined → system prompt shows → grant → session starts
  - Denied → in‑app alert + Settings deep link → enable → back → session starts
  - Granted → session starts immediately
- Onboarding skipped purchase:
  - Settings > Plan reachable; paywall auto‑shown when quota reached; Restore works
- Paywall:
  - Billed amount is most conspicuous, monthly equivalents (if any) are subordinate

## Out of Scope / Non‑Changes

- No main‑screen subscription CTA added
- No custom EULA; Apple Standard EULA only
- No custom receipt validation; RevenueCat handles validation with Apple

### To-dos

- [ ] Implement mic permission preflight and alert in SessionView before start()
- [ ] Ensure no main-screen subscription CTA is added (Settings only discovery)
- [ ] Add optional usage placeholder in Settings while syncing usage info
- [ ] Verify Description has Privacy/EULA links for all locales
- [ ] Update each auto-renewable IAP: name, desc, duration, price, group, screenshot
- [ ] Verify billed amount prominence on RC paywall; legal links, restore present
- [ ] Run iPad Air (iPadOS 26.1) tests for Undetermined/Denied/Granted states
- [ ] Submit the prepared English/Japanese review response in ASC messages