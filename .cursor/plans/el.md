# å®Ÿè£…ä»•æ§˜æ›¸ + å®Œå…¨ãƒ‘ãƒƒãƒï¼ˆæœ€çµ‚ç‰ˆï¼‰

---

## æ¦‚è¦

| # | é …ç›® | å„ªå…ˆåº¦ |
|---|------|--------|
| 1 | æ’®å½±ç”¨ãƒ‡ãƒãƒƒã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³ä¿®æ­£ï¼ˆ7â†’8 ã‚’ 6â†’7 ã«ï¼‰ | é«˜ |
| 2 | ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚µã‚¤ã‚ºæ‹¡å¤§ + Figmaæº–æ‹  | é«˜ |
| 3 | ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã‚¢ã‚¤ã‚³ãƒ³å¤‰æ›´ï¼ˆğŸ”¥ â†’ ğŸª·ï¼‰+ å³ä¸Šé…ç½® | é«˜ |
| 4 | ã‚¹ãƒˆãƒªãƒ¼ã‚¯é”æˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°å®Ÿè£…ï¼ˆã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³ãªã—ï¼‰ | é«˜ |

---

ä»Šå›å®Ÿç¾ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“
#	ä½“é¨“	è©³ç´°
1	ç¿’æ…£ã®å®Œäº†ãƒã‚§ãƒƒã‚¯	å„ç¿’æ…£ã‚«ãƒ¼ãƒ‰ã®å·¦ç«¯ã«ã‚ã‚‹32pxã®å††å½¢ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€ãã®æ—¥ã®å®Œäº†ã‚’ãƒãƒ¼ã‚¯ã§ãã‚‹
2	ã‚¹ãƒˆãƒªãƒ¼ã‚¯è¡¨ç¤º	é€£ç¶šé”æˆæ—¥æ•°ãŒğŸª·ã‚¢ã‚¤ã‚³ãƒ³ã¨æ•°å­—ã§ã‚«ãƒ¼ãƒ‰å³ä¸Šã«ãƒ”ãƒ«å‹èƒŒæ™¯ã§è¡¨ç¤ºã•ã‚Œã‚‹
3	ã‚¹ãƒˆãƒªãƒ¼ã‚¯åŠ ç®—	ãƒã‚§ãƒƒã‚¯ONã§ã‚¹ãƒˆãƒªãƒ¼ã‚¯+1ã€OFFã§-1
4	ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒªã‚»ãƒƒãƒˆ	ãƒã‚§ãƒƒã‚¯OFFã®ã¾ã¾ç¿Œæ—¥0æ™‚ã‚’è¿ãˆã‚‹ã¨ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãŒ0ã«ãƒªã‚»ãƒƒãƒˆ
5	ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ç¥ç¦	7/14/21/30/60/90/100/365æ—¥é”æˆæ™‚ã«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
6	æ’®å½±ç”¨ãƒ‡ãƒãƒƒã‚°	ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»é¢ã‹ã‚‰æ’®å½±ç”¨ã®ã‚¹ãƒˆãƒªãƒ¼ã‚¯å€¤ã‚’è¨­å®šå¯èƒ½ï¼ˆ29â†’30ã€6â†’7ãªã©ï¼‰

## æ³¨æ„äº‹é …

- **ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒ‡ãƒ¼ã‚¿ã¯UserDefaultsï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰ã®ã¿ä¿å­˜**
- ã‚¢ãƒ—ãƒªå‰Šé™¤ã§æ¶ˆãˆã‚‹ã€åˆ¥ãƒ‡ãƒã‚¤ã‚¹ã§å¼•ãç¶™ãŒã‚Œãªã„
- ã‚µãƒ¼ãƒãƒ¼åŒæœŸã¯ä»Šå›ã‚¹ã‚³ãƒ¼ãƒ—å¤–ï¼ˆä»Šå¾Œã®èª²é¡Œï¼‰

---

## 1. æ’®å½±ç”¨ãƒ‡ãƒãƒƒã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³ä¿®æ­£

### AppState.swift - setupRecording ãƒ¡ã‚½ãƒƒãƒ‰

```swift
// æ—§ã‚³ãƒ¼ãƒ‰:
case 4: // 7â†’8ç”¨ï¼ˆãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã ã‘æœªå®Œäº†ï¼‰
    setStreakForRecording(habitId: "wake", streak: 30, completed: true)
    setStreakForRecording(habitId: "training", streak: 7, completed: false)
    setStreakForRecording(habitId: "bedtime", streak: 30, completed: true)
    for (index, config) in customHabits.enumerated() {
        setStreakForRecording(habitId: config.id.uuidString, streak: customStreaksCompleted[index % 4], completed: true)
    }

// æ–°ã‚³ãƒ¼ãƒ‰:
case 4: // 6â†’7ç”¨ï¼ˆ7æ—¥é”æˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°æ’®å½±ç”¨ï¼‰
    setStreakForRecording(habitId: "wake", streak: 30, completed: true)
    setStreakForRecording(habitId: "training", streak: 6, completed: false) // 6ã«å¤‰æ›´
    setStreakForRecording(habitId: "bedtime", streak: 30, completed: true)
    for (index, config) in customHabits.enumerated() {
        setStreakForRecording(habitId: config.id.uuidString, streak: customStreaksCompleted[index % 4], completed: true)
    }
```

### ProfileView.swift - ãƒœã‚¿ãƒ³ãƒ©ãƒ™ãƒ«ä¿®æ­£

```swift
// æ—§:
Button("4ï¸âƒ£ 7â†’8ç”¨") {
    appState.setupRecording(pattern: 4)
}

// æ–°:
Button("4ï¸âƒ£ 6â†’7ç”¨ï¼ˆ7æ—¥é”æˆï¼‰") {
    appState.setupRecording(pattern: 4)
}
```

---

## 2. ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ - Figmaæº–æ‹ ï¼ˆå††å½¢ã€ã‚´ãƒ¼ãƒ«ãƒ‰ã€32pxï¼‰

### HabitsSectionView.swift - checkBox ãƒ¡ã‚½ãƒƒãƒ‰

```swift
// æ—§ã‚³ãƒ¼ãƒ‰:
// MARK: - Checkbox Component
@ViewBuilder
private func checkBox(isCompleted: Bool, onTap: @escaping () -> Void) -> some View {
    Button {
        withAnimation(.spring(response: 0.3, dampingFraction: 0.6)) {
            onTap()
        }
        if !isCompleted {
            let generator = UINotificationFeedbackGenerator()
            generator.notificationOccurred(.success)
        }
    } label: {
        ZStack {
            RoundedRectangle(cornerRadius: 6)
                .stroke(isCompleted ? Color.clear : AppTheme.Colors.border, lineWidth: 1.5)
                .background(
                    RoundedRectangle(cornerRadius: 6)
                        .fill(isCompleted ? AppTheme.Colors.accent : Color.clear)
                )
                .frame(width: 24, height: 24)
            
            if isCompleted {
                Image(systemName: "checkmark")
                    .font(.system(size: 14, weight: .bold))
                    .foregroundColor(.white)
                    .scaleEffect(isCompleted ? 1.0 : 0.5)
            }
        }
        .scaleEffect(isCompleted ? 1.0 : 0.95)
    }
    .buttonStyle(.plain)
}

// æ–°ã‚³ãƒ¼ãƒ‰ï¼ˆFigmaæº–æ‹ ï¼‰:
// MARK: - Checkbox Component
@ViewBuilder
private func checkBox(isCompleted: Bool, onTap: @escaping () -> Void) -> some View {
    Button {
        withAnimation(.spring(response: 0.3, dampingFraction: 0.6)) {
            onTap()
        }
        if !isCompleted {
            let generator = UINotificationFeedbackGenerator()
            generator.notificationOccurred(.success)
        }
    } label: {
        ZStack {
            Circle()  // Figmaã§ã¯å††å½¢
                .stroke(isCompleted ? Color.clear : Color(red: 0.79, green: 0.70, blue: 0.51), lineWidth: 2.5)
                .background(
                    Circle()
                        .fill(isCompleted ? Color(red: 0.79, green: 0.70, blue: 0.51) : Color.clear)  // #C9B382
                )
                .frame(width: 32, height: 32)
            
            if isCompleted {
                Image(systemName: "checkmark")
                    .font(.system(size: 16, weight: .bold))
                    .foregroundColor(.white)
                    .scaleEffect(isCompleted ? 1.0 : 0.5)
            }
        }
        .scaleEffect(isCompleted ? 1.0 : 0.95)
    }
    .buttonStyle(.plain)
    .frame(width: 44, height: 44)  // ã‚¿ãƒƒãƒ—é ˜åŸŸç¢ºä¿
    .contentShape(Rectangle())
}
```

---

## 3. habitRow - ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒãƒƒã‚¸ã‚’å³ä¸Šã«é…ç½®ï¼ˆFigmaæº–æ‹ ï¼‰

### HabitsSectionView.swift - habitRow ãƒ¡ã‚½ãƒƒãƒ‰å…¨ä½“

```swift
// æ—§ã‚³ãƒ¼ãƒ‰:
private func habitRow(for habit: HabitType, time: DateComponents?) -> some View {
    let isActive = activeHabits.contains(habit)
    let date = time.flatMap { Calendar.current.date(from: $0) }
    let habitId = habit.rawValue
    let isCompleted = appState.isDailyCompleted(for: habitId)
    let streak = appState.currentStreak(for: habitId)

    HStack(spacing: 12) {
        // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
        checkBox(isCompleted: isCompleted) {
            if isCompleted {
                appState.unmarkDailyCompleted(for: habitId)
            } else {
                appState.markDailyCompleted(for: habitId)
            }
        }
        
        // ç¿’æ…£å
        Text(habit.title)
            .font(AppTheme.Typography.headlineDynamic)
            .foregroundStyle(AppTheme.Colors.label)
            .frame(maxWidth: .infinity, alignment: .leading)
            .contentShape(Rectangle())
            .onTapGesture {
                if isActive {
                    activeSheet = .editor(habit)
                } else {
                    sheetTime = date ?? Calendar.current.date(from: habit.defaultTime) ?? Date()
                    activeSheet = .habit(habit)
                }
            }

        // ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒãƒƒã‚¸ï¼ˆå›ºå®šå¹…ã§ä½ç½®ã‚’æƒãˆã‚‹ï¼‰
        Text(streak > 0 ? "ğŸ”¥\(streak)" : "")
            .font(.system(size: 12, weight: .medium))
            .foregroundStyle(Color.orange)
            .frame(width: 40, alignment: .trailing)

        // æ™‚åˆ»è¡¨ç¤ºï¼ˆå›ºå®šå¹…ã§ä½ç½®ã‚’æƒãˆã‚‹ï¼‰
        Text(isActive && date != nil ? date!.formatted(.dateTime.hour().minute()) : "")
            .font(AppTheme.Typography.subheadlineDynamic)
            .foregroundStyle(AppTheme.Colors.secondaryLabel)
            .frame(width: 50, alignment: .trailing)

        // ãƒˆã‚°ãƒ«
        Toggle("", isOn: Binding(
            // ... æ—¢å­˜ã®ãƒˆã‚°ãƒ«ãƒ­ã‚¸ãƒƒã‚¯ ...
        ))
        .labelsHidden()
        .tint(AppTheme.Colors.accent)
    }
}

// æ–°ã‚³ãƒ¼ãƒ‰ï¼ˆFigmaæº–æ‹  - ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒãƒƒã‚¸ã‚’å³ä¸Šã«é…ç½®ï¼‰:
private func habitRow(for habit: HabitType, time: DateComponents?) -> some View {
    let isActive = activeHabits.contains(habit)
    let date = time.flatMap { Calendar.current.date(from: $0) }
    let habitId = habit.rawValue
    let isCompleted = appState.isDailyCompleted(for: habitId)
    let streak = appState.currentStreak(for: habitId)
    
    ZStack(alignment: .topTrailing) {
        // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
        HStack(spacing: 16) {
            // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
            checkBox(isCompleted: isCompleted) {
                if isCompleted {
                    appState.unmarkDailyCompleted(for: habitId)
                } else {
                    appState.markDailyCompleted(for: habitId)
                }
            }
            
            // ç¿’æ…£å
            Text(habit.title)
                .font(.system(size: 16, weight: .medium))
                .foregroundStyle(Color(red: 0.23, green: 0.23, blue: 0.23))  // #3A3A3A
                .frame(maxWidth: .infinity, alignment: .leading)
                .contentShape(Rectangle())
                .onTapGesture {
                    if isActive {
                        activeSheet = .editor(habit)
                    } else {
                        sheetTime = date ?? Calendar.current.date(from: habit.defaultTime) ?? Date()
                        activeSheet = .habit(habit)
                    }
                }
            
            // æ™‚åˆ»è¡¨ç¤º
            if isActive, let date = date {
                Text(date.formatted(.dateTime.hour().minute()))
                    .font(.system(size: 14))
                    .foregroundStyle(Color(red: 0.54, green: 0.54, blue: 0.51))  // #8A8A82
            }
            
            // ãƒˆã‚°ãƒ«
            Toggle("", isOn: Binding(
                get: { activeHabits.contains(habit) },
                set: { isOn in
                    withAnimation(.easeInOut(duration: 0.18)) {
                        if isOn {
                            if let date = date {
                                if habit == .wake {
                                    Task {
                                        await requestAlarmKitPermissionIfNeeded()
                                    }
                                }
                                activeHabits.insert(habit)
                                habitTimes[habit] = date
                            } else {
                                sheetTime = Calendar.current.date(from: habit.defaultTime) ?? Date()
                                activeSheet = .habit(habit)
                            }
                        } else {
                            activeHabits.remove(habit)
                            Task { @MainActor in
                                try? await Task.sleep(nanoseconds: 220_000_000)
                                var t = Transaction()
                                t.disablesAnimations = true
                                withTransaction(t) {
                                    habitTimes.removeValue(forKey: habit)
                                    appState.removeHabitSchedule(habit)
                                }
                            }
                        }
                    }
                }
            ))
            .labelsHidden()
            .tint(Color(red: 0.79, green: 0.70, blue: 0.51))  // #C9B382
        }
        .padding(.vertical, 20)
        .padding(.horizontal, 20)
        
        // ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒãƒƒã‚¸ï¼ˆå³ä¸Šè§’ã«é…ç½®ï¼‰
        if streak > 0 {
            HStack(spacing: 4) {
                Text("ğŸª·")
                    .font(.system(size: 14))
                Text("\(streak)")
                    .font(.system(size: 10, weight: .semibold))
                    .foregroundStyle(Color(red: 0.79, green: 0.70, blue: 0.51))  // #C9B382
            }
            .padding(.horizontal, 8)
            .padding(.vertical, 4)
            .background(
                Capsule()
                    .fill(Color(red: 0.79, green: 0.70, blue: 0.51).opacity(0.1))  // è–„ã„ã‚´ãƒ¼ãƒ«ãƒ‰èƒŒæ™¯
            )
            .padding(.top, 8)
            .padding(.trailing, 12)
        }
    }
}
```

---

## 4. customHabitRow - åŒæ§˜ã®å¤‰æ›´

```swift
// customHabitRow ã‚‚ habitRow ã¨åŒã˜æ§‹é€ ã«å¤‰æ›´
// ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒãƒƒã‚¸ã‚’å³ä¸Šã«é…ç½®ã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’å††å½¢ãƒ»ã‚´ãƒ¼ãƒ«ãƒ‰ã«
// ä¸Šè¨˜ habitRow ã®æ§‹é€ ã‚’å‚è€ƒã«ä¿®æ­£
```

---

## 5. ã‚¹ãƒˆãƒªãƒ¼ã‚¯é”æˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³ãªã—ï¼‰

### æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«: StreakMilestoneSheet.swift

```swift
import SwiftUI

struct StreakMilestoneSheet: View {
    let habitName: String
    let streak: Int
    let onDismiss: () -> Void
    
    @State private var showAnimation = false
    @State private var scale: CGFloat = 0.8
    @State private var opacity: Double = 0
    
    static let milestones: Set<Int> = [7, 14, 21, 30, 60, 90, 100, 365]
    
    private var milestoneTitle: String {
        switch streak {
        case 7: return String(localized: "milestone_7_title", defaultValue: "1é€±é–“ã€ç¶šã‘ã‚‰ã‚Œã¾ã—ãŸ")
        case 14: return String(localized: "milestone_14_title", defaultValue: "2é€±é–“ã€ç¶šã‘ã‚‰ã‚Œã¾ã—ãŸ")
        case 21: return String(localized: "milestone_21_title", defaultValue: "3é€±é–“ã€ç¶šã‘ã‚‰ã‚Œã¾ã—ãŸ")
        case 30: return String(localized: "milestone_30_title", defaultValue: "1ãƒ¶æœˆã€ç¶šã‘ã‚‰ã‚Œã¾ã—ãŸ")
        case 60: return String(localized: "milestone_60_title", defaultValue: "2ãƒ¶æœˆã€ç¶šã‘ã‚‰ã‚Œã¾ã—ãŸ")
        case 90: return String(localized: "milestone_90_title", defaultValue: "3ãƒ¶æœˆã€ç¶šã‘ã‚‰ã‚Œã¾ã—ãŸ")
        case 100: return String(localized: "milestone_100_title", defaultValue: "100æ—¥ã€ç¶šã‘ã‚‰ã‚Œã¾ã—ãŸ")
        case 365: return String(localized: "milestone_365_title", defaultValue: "1å¹´ã€ç¶šã‘ã‚‰ã‚Œã¾ã—ãŸ")
        default: return String(localized: "milestone_generic_title", defaultValue: "ç´ æ™´ã‚‰ã—ã„ç¶™ç¶šã§ã™")
        }
    }
    
    private var milestoneSubtitle: String {
        String(localized: "milestone_subtitle \(habitName) \(streak)", 
               defaultValue: "\(habitName)ã‚’\(streak)æ—¥é–“ç¶šã‘ã¦ã„ã¾ã™")
    }
    
    var body: some View {
        ZStack {
            // èƒŒæ™¯ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆFigma: rgba(0,0,0,0.5) + blurï¼‰
            Color.black.opacity(0.5)
                .ignoresSafeArea()
                .onTapGesture { dismiss() }
            
            // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚«ãƒ¼ãƒ‰
            VStack(spacing: 0) {
                // è“®ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆFigma: 96pxå††ã€#F4D9D0 30%èƒŒæ™¯ï¼‰
                ZStack {
                    Circle()
                        .fill(Color(red: 0.96, green: 0.85, blue: 0.82).opacity(0.3))
                        .frame(width: 96, height: 96)
                    
                    Text("ğŸª·")
                        .font(.system(size: 48))
                        .scaleEffect(showAnimation ? 1.05 : 1.0)
                        .animation(.easeInOut(duration: 1.5).repeatForever(autoreverses: true), value: showAnimation)
                }
                .padding(.top, 32)
                
                // æ—¥æ•°è¡¨ç¤ºï¼ˆFigma: 72px bold #D4A574ï¼‰
                HStack(alignment: .lastTextBaseline, spacing: 0) {
                    Text("\(streak)")
                        .font(.system(size: 72, weight: .bold, design: .rounded))
                        .foregroundStyle(Color(red: 0.83, green: 0.65, blue: 0.46))
                    
                    Text("æ—¥")
                        .font(.system(size: 24, weight: .medium))
                        .foregroundStyle(Color(red: 0.83, green: 0.65, blue: 0.46))
                        .padding(.bottom, 12)
                }
                .padding(.top, 24)
                
                // åŒºåˆ‡ã‚Šç·šï¼ˆFigma: 48px x 2pxï¼‰
                RoundedRectangle(cornerRadius: 1)
                    .fill(Color(red: 0.83, green: 0.65, blue: 0.46).opacity(0.3))
                    .frame(width: 48, height: 2)
                    .padding(.top, 4)
                
                // ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆFigma: 24px bold #3A3A3Aï¼‰
                Text(milestoneTitle)
                    .font(.system(size: 24, weight: .bold))
                    .foregroundStyle(Color(red: 0.23, green: 0.23, blue: 0.23))
                    .multilineTextAlignment(.center)
                    .padding(.top, 24)
                
                // ã‚µãƒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆFigma: 16px #9CA3AFï¼‰
                Text(milestoneSubtitle)
                    .font(.system(size: 16))
                    .foregroundStyle(Color(red: 0.61, green: 0.64, blue: 0.69))
                    .multilineTextAlignment(.center)
                    .padding(.top, 12)
                    .padding(.horizontal, 24)
                
                // ç¶šã‘ã‚‹ãƒœã‚¿ãƒ³ï¼ˆFigma: ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ #D4A574â†’#E8B896ï¼‰
                Button(action: dismiss) {
                    Text(String(localized: "milestone_continue", defaultValue: "ç¶šã‘ã¦ã„ã"))
                        .font(.system(size: 18, weight: .bold))
                        .foregroundStyle(.white)
                        .frame(maxWidth: .infinity)
                        .padding(.vertical, 18)
                        .background(
                            LinearGradient(
                                colors: [
                                    Color(red: 0.83, green: 0.65, blue: 0.46),
                                    Color(red: 0.91, green: 0.72, blue: 0.59)
                                ],
                                startPoint: .top,
                                endPoint: .bottom
                            )
                        )
                        .clipShape(Capsule())
                        .shadow(color: Color(red: 0.83, green: 0.65, blue: 0.46).opacity(0.3), radius: 10, y: 4)
                }
                .padding(.horizontal, 32)
                .padding(.top, 32)
                .padding(.bottom, 32)
            }
            .background(Color.white)
            .clipShape(RoundedRectangle(cornerRadius: 24))
            .shadow(color: .black.opacity(0.15), radius: 20, y: 10)
            .padding(.horizontal, 24)
            .scaleEffect(scale)
            .opacity(opacity)
        }
        .onAppear {
            withAnimation(.spring(response: 0.5, dampingFraction: 0.7)) {
                scale = 1.0
                opacity = 1.0
            }
            DispatchQueue.main.asyncAfter(deadline: .now() + 0.3) {
                showAnimation = true
            }
            let generator = UINotificationFeedbackGenerator()
            generator.notificationOccurred(.success)
        }
    }
    
    private func dismiss() {
        withAnimation(.easeOut(duration: 0.2)) {
            scale = 0.8
            opacity = 0
        }
        DispatchQueue.main.asyncAfter(deadline: .now() + 0.2) {
            onDismiss()
        }
    }
}
```

---

## 6. AppState.swift - ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³é€£æº

### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¿½åŠ 

```swift
// @Published ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¿½åŠ :
@Published var pendingMilestone: (habitName: String, streak: Int)? = nil

// private ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«è¿½åŠ :
private let milestones: Set<Int> = [7, 14, 21, 30, 60, 90, 100, 365]
```

### markDailyCompleted ãƒ¡ã‚½ãƒƒãƒ‰ä¿®æ­£

```swift
func markDailyCompleted(for habitId: String) {
    updateStreaksIfNeeded()
    
    var data = habitStreaks[habitId] ?? HabitStreakData()
    let today = Calendar.current.startOfDay(for: Date())
    
    guard data.lastCompletedDate != today else { return }
    
    if let lastDate = data.lastCompletedDate {
        let yesterday = Calendar.current.date(byAdding: .day, value: -1, to: today)!
        if Calendar.current.isDate(lastDate, inSameDayAs: yesterday) {
            data.currentStreak += 1
        } else {
            data.currentStreak = 1
        }
    } else {
        data.currentStreak = 1
    }
    
    data.lastCompletedDate = today
    habitStreaks[habitId] = data
    saveHabitStreaks()
    
    // ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³é”æˆãƒã‚§ãƒƒã‚¯ï¼ˆæ–°è¦è¿½åŠ ï¼‰
    if milestones.contains(data.currentStreak) {
        let habitName = getHabitDisplayName(for: habitId)
        pendingMilestone = (habitName: habitName, streak: data.currentStreak)
    }
}
```

### æ–°è¦ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰

```swift
private func getHabitDisplayName(for habitId: String) -> String {
    if let habitType = HabitType(rawValue: habitId) {
        return habitType.title
    }
    if let customConfig = customHabits.first(where: { $0.id.uuidString == habitId }) {
        return customConfig.name
    }
    return habitId
}
```

---

## 7. HabitsSectionView.swift - ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º

### body ã®æœ€å¾Œã«è¿½åŠ 

```swift
// .sheet ã®å¾Œã«è¿½åŠ :
.overlay {
    if let milestone = appState.pendingMilestone {
        StreakMilestoneSheet(
            habitName: milestone.habitName,
            streak: milestone.streak
        ) {
            appState.pendingMilestone = nil
        }
    }
}
```

---

## 8. ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºæ–‡å­—åˆ—ï¼ˆã‚·ã‚§ã‚¢å‰Šé™¤ç‰ˆï¼‰

### Localizable.xcstrings ã«è¿½åŠ 

```json
{
  "milestone_7_title": {
    "localizations": {
      "en": { "stringUnit": { "state": "translated", "value": "1 Week Strong!" } },
      "ja": { "stringUnit": { "state": "translated", "value": "1é€±é–“ã€ç¶šã‘ã‚‰ã‚Œã¾ã—ãŸ" } }
    }
  },
  "milestone_14_title": {
    "localizations": {
      "en": { "stringUnit": { "state": "translated", "value": "2 Weeks Strong!" } },
      "ja": { "stringUnit": { "state": "translated", "value": "2é€±é–“ã€ç¶šã‘ã‚‰ã‚Œã¾ã—ãŸ" } }
    }
  },
  "milestone_21_title": {
    "localizations": {
      "en": { "stringUnit": { "state": "translated", "value": "3 Weeks Strong!" } },
      "ja": { "stringUnit": { "state": "translated", "value": "3é€±é–“ã€ç¶šã‘ã‚‰ã‚Œã¾ã—ãŸ" } }
    }
  },
  "milestone_30_title": {
    "localizations": {
      "en": { "stringUnit": { "state": "translated", "value": "1 Month Strong!" } },
      "ja": { "stringUnit": { "state": "translated", "value": "1ãƒ¶æœˆã€ç¶šã‘ã‚‰ã‚Œã¾ã—ãŸ" } }
    }
  },
  "milestone_60_title": {
    "localizations": {
      "en": { "stringUnit": { "state": "translated", "value": "2 Months Strong!" } },
      "ja": { "stringUnit": { "state": "translated", "value": "2ãƒ¶æœˆã€ç¶šã‘ã‚‰ã‚Œã¾ã—ãŸ" } }
    }
  },
  "milestone_90_title": {
    "localizations": {
      "en": { "stringUnit": { "state": "translated", "value": "3 Months Strong!" } },
      "ja": { "stringUnit": { "state": "translated", "value": "3ãƒ¶æœˆã€ç¶šã‘ã‚‰ã‚Œã¾ã—ãŸ" } }
    }
  },
  "milestone_100_title": {
    "localizations": {
      "en": { "stringUnit": { "state": "translated", "value": "100 Days Strong!" } },
      "ja": { "stringUnit": { "state": "translated", "value": "100æ—¥ã€ç¶šã‘ã‚‰ã‚Œã¾ã—ãŸ" } }
    }
  },
  "milestone_365_title": {
    "localizations": {
      "en": { "stringUnit": { "state": "translated", "value": "1 Year Strong!" } },
      "ja": { "stringUnit": { "state": "translated", "value": "1å¹´ã€ç¶šã‘ã‚‰ã‚Œã¾ã—ãŸ" } }
    }
  },
  "milestone_generic_title": {
    "localizations": {
      "en": { "stringUnit": { "state": "translated", "value": "Amazing Consistency!" } },
      "ja": { "stringUnit": { "state": "translated", "value": "ç´ æ™´ã‚‰ã—ã„ç¶™ç¶šã§ã™" } }
    }
  },
  "milestone_subtitle %@ %lld": {
    "localizations": {
      "en": { "stringUnit": { "state": "translated", "value": "You've kept up with %1$@ for %2$lld days" } },
      "ja": { "stringUnit": { "state": "translated", "value": "%1$@ã‚’%2$lldæ—¥é–“ç¶šã‘ã¦ã„ã¾ã™" } }
    }
  },
  "milestone_continue": {
    "localizations": {
      "en": { "stringUnit": { "state": "translated", "value": "Keep Going" } },
      "ja": { "stringUnit": { "state": "translated", "value": "ç¶šã‘ã¦ã„ã" } }
    }
  }
}
```

---

## æ’®å½±ç”¨ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ã¾ã¨ã‚

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | å†…å®¹ | ç”¨é€” |
|----------|------|------|
| **1ï¸âƒ£** | ãƒãƒ©ãƒãƒ©ã‚¹ãƒˆãƒªãƒ¼ã‚¯ï¼ˆå…¨ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ï¼‰ | ç¿’æ…£ã‚¿ãƒ–å…¨ä½“ã®è¦‹ãŸç›®æ’®å½± |
| **2ï¸âƒ£** | 29â†’30ç”¨ï¼ˆå…¨éƒ¨æœªå®Œäº†ï¼‰ | 30æ—¥é”æˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°æ’®å½± |
| **4ï¸âƒ£** | 6â†’7ç”¨ï¼ˆãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã ã‘æœªå®Œäº†ï¼‰ | 7æ—¥é”æˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°æ’®å½± |
| **5ï¸âƒ£** | å…¨éƒ¨ğŸª·30 | å®Œç’§ãªçŠ¶æ…‹ã®æ’®å½± |

---

## Figmaãƒ‡ã‚¶ã‚¤ãƒ³å¯¾å¿œç¢ºèª

| Figmaè¦ç´  | è‰²/ã‚µã‚¤ã‚º | ãƒ‘ãƒƒãƒåæ˜  |
|-----------|----------|-----------|
| **ãƒ€ã‚¤ã‚¢ãƒ­ã‚°èƒŒæ™¯** | rgba(0,0,0,0.5) | âœ… |
| **ã‚«ãƒ¼ãƒ‰è§’ä¸¸** | 24px | âœ… |
| **è“®ã‚¢ã‚¤ã‚³ãƒ³èƒŒæ™¯** | #F4D9D0 30%ã€96pxå†† | âœ… |
| **æ—¥æ•°ãƒ†ã‚­ã‚¹ãƒˆ** | 72px bold #D4A574 | âœ… |
| **ã€Œæ—¥ã€ãƒ†ã‚­ã‚¹ãƒˆ** | 24px #D4A574 | âœ… |
| **åŒºåˆ‡ã‚Šç·š** | 48px x 2px | âœ… |
| **ã‚¿ã‚¤ãƒˆãƒ«** | 24px bold #3A3A3A | âœ… |
| **ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«** | 16px #9CA3AF | âœ… |
| **ãƒœã‚¿ãƒ³ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³** | #D4A574â†’#E8B896 | âœ… |
| **ã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³** | å‰Šé™¤ | âœ… |
| **ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹** | 32pxå††ã€#C9B382 | âœ… |
| **ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒãƒƒã‚¸** | å³ä¸Šè§’ã€ãƒ”ãƒ«å‹ã€è–„ã‚´ãƒ¼ãƒ«ãƒ‰èƒŒæ™¯ | âœ… |
| **ãƒˆã‚°ãƒ«è‰²** | #C9B382 | âœ… |

---

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ãƒ•ãƒ­ãƒ¼

### æ¯æ—¥ã®ç¿’æ…£ãƒã‚§ãƒƒã‚¯
1. ã‚¢ãƒ—ãƒªã‚’é–‹ã â†’ ç¿’æ…£ã‚¿ãƒ–è¡¨ç¤º
2. å„ã‚«ãƒ¼ãƒ‰ã«ğŸª·ã‚¢ã‚¤ã‚³ãƒ³ã¨ç¶™ç¶šæ—¥æ•°ãŒå³ä¸Šã«è¡¨ç¤º
3. ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼ˆ32pxå††å½¢ï¼‰ã‚’ã‚¿ãƒƒãƒ—
4. ã‚¹ãƒ—ãƒªãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ + ãƒãƒ—ãƒ†ã‚£ãƒƒã‚¯ + ã‚¹ãƒˆãƒªãƒ¼ã‚¯+1

### ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³é”æˆæ™‚ï¼ˆ7/14/21/30/60/90/100/365æ—¥ï¼‰
1. ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³é”æˆ
2. ãŠç¥ã„ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§è¡¨ç¤º
3. ã€Œç¶šã‘ã¦ã„ãã€ã‚’ã‚¿ãƒƒãƒ—ã—ã¦é–‰ã˜ã‚‹

### ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã—ãŸå ´åˆ
- ã‚¹ãƒˆãƒªãƒ¼ã‚¯-1ã€å†åº¦ãƒã‚§ãƒƒã‚¯ã§+1ï¼ˆåŒæ—¥å†…ãªã‚‰ä½•åº¦ã§ã‚‚ã‚„ã‚Šç›´ã—å¯èƒ½ï¼‰

### ç¿Œæ—¥ã«ãªã£ãŸå ´åˆ
- ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¯ãƒªã‚»ãƒƒãƒˆã€ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã¯ç¶­æŒ
- ä»Šæ—¥ã‚‚ãƒã‚§ãƒƒã‚¯ â†’ ã‚¹ãƒˆãƒªãƒ¼ã‚¯+1

### ãƒã‚§ãƒƒã‚¯å¿˜ã‚Œã¦ç¿Œæ—¥
- ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒªã‚»ãƒƒãƒˆï¼ˆ0ï¼‰â†’ ä»Šæ—¥ãƒã‚§ãƒƒã‚¯ã§1ã‹ã‚‰å†ã‚¹ã‚¿ãƒ¼ãƒˆ

äº†è§£ã—ã¾ã—ãŸã€‚

---

## ä»Šå›å®Ÿç¾ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“

| # | ä½“é¨“ | è©³ç´° |
|---|------|------|
| 1 | ç¿’æ…£ã®å®Œäº†ãƒã‚§ãƒƒã‚¯ | å„ç¿’æ…£ã‚«ãƒ¼ãƒ‰ã®å·¦ç«¯ã«ã‚ã‚‹32pxã®å††å½¢ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€ãã®æ—¥ã®å®Œäº†ã‚’ãƒãƒ¼ã‚¯ã§ãã‚‹ |
| 2 | ã‚¹ãƒˆãƒªãƒ¼ã‚¯è¡¨ç¤º | é€£ç¶šé”æˆæ—¥æ•°ãŒğŸª·ã‚¢ã‚¤ã‚³ãƒ³ã¨æ•°å­—ã§ã‚«ãƒ¼ãƒ‰å³ä¸Šã«ãƒ”ãƒ«å‹èƒŒæ™¯ã§è¡¨ç¤ºã•ã‚Œã‚‹ |
| 3 | ã‚¹ãƒˆãƒªãƒ¼ã‚¯åŠ ç®— | ãƒã‚§ãƒƒã‚¯ONã§ã‚¹ãƒˆãƒªãƒ¼ã‚¯+1ã€OFFã§-1 |
| 4 | ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒªã‚»ãƒƒãƒˆ | ãƒã‚§ãƒƒã‚¯OFFã®ã¾ã¾ç¿Œæ—¥0æ™‚ã‚’è¿ãˆã‚‹ã¨ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãŒ0ã«ãƒªã‚»ãƒƒãƒˆ |
| 5 | ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ç¥ç¦ | 7/14/21/30/60/90/100/365æ—¥é”æˆæ™‚ã«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º |
| 6 | æ’®å½±ç”¨ãƒ‡ãƒãƒƒã‚° | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»é¢ã‹ã‚‰æ’®å½±ç”¨ã®ã‚¹ãƒˆãƒªãƒ¼ã‚¯å€¤ã‚’è¨­å®šå¯èƒ½ï¼ˆ29â†’30ã€6â†’7ãªã©ï¼‰ |

---

## è¿½åŠ ãƒ‘ãƒƒãƒâ‘ : customHabitRow

```swift
private func customHabitRow(id: UUID, name: String, time: DateComponents?) -> some View {
    let isActive = activeCustomHabits.contains(id)
    let date = time.flatMap { Calendar.current.date(from: $0) }
    let habitId = id.uuidString
    let isCompleted = appState.isDailyCompleted(for: habitId)
    let streak = appState.currentStreak(for: habitId)

    CardView {
        ZStack(alignment: .topTrailing) {
            // ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒãƒƒã‚¸ï¼ˆå³ä¸Šï¼‰
            if streak > 0 {
                Text("ğŸª·\(streak)")
                    .font(.system(size: 11, weight: .semibold))
                    .foregroundStyle(Color(hex: "#C9B382"))
                    .padding(.horizontal, 6)
                    .padding(.vertical, 2)
                    .background(
                        Capsule()
                            .fill(Color(hex: "#C9B382").opacity(0.15))
                    )
                    .offset(x: -4, y: 4)
            }
            
            // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
            HStack(spacing: 12) {
                // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
                checkBox(isCompleted: isCompleted) {
                    if isCompleted {
                        appState.unmarkDailyCompleted(for: habitId)
                    } else {
                        appState.markDailyCompleted(for: habitId)
                    }
                }
                
                // ç¿’æ…£å
                Text(name)
                    .font(AppTheme.Typography.headlineDynamic)
                    .foregroundStyle(AppTheme.Colors.label)
                    .frame(maxWidth: .infinity, alignment: .leading)
                    .contentShape(Rectangle())
                    .onTapGesture {
                        if isActive {
                            activeSheet = .customEditor(id)
                        } else {
                            sheetTime = date ?? Date()
                            activeSheet = .custom(id)
                        }
                    }
                
                // æ™‚åˆ»è¡¨ç¤º
                Text(isActive && date != nil ? date!.formatted(.dateTime.hour().minute()) : "")
                    .font(AppTheme.Typography.subheadlineDynamic)
                    .foregroundStyle(AppTheme.Colors.secondaryLabel)
                    .frame(width: 50, alignment: .trailing)
                
                // ãƒˆã‚°ãƒ«
                Toggle("", isOn: Binding(
                    get: { activeCustomHabits.contains(id) },
                    set: { isOn in
                        withAnimation(.easeInOut(duration: 0.18)) {
                            if isOn {
                                if let date = date {
                                    activeCustomHabits.insert(id)
                                    customHabitTimes[id] = date
                                } else {
                                    sheetTime = Date()
                                    activeSheet = .custom(id)
                                }
                            } else {
                                activeCustomHabits.remove(id)
                                Task { @MainActor in
                                    try? await Task.sleep(nanoseconds: 220_000_000)
                                    var t = Transaction()
                                    t.disablesAnimations = true
                                    withTransaction(t) {
                                        customHabitTimes.removeValue(forKey: id)
                                        appState.updateCustomHabitSchedule(id: id, time: nil)
                                    }
                                }
                            }
                        }
                    }
                ))
                .labelsHidden()
                .tint(Color(hex: "#C9B382"))
            }
            .padding(.vertical, 35)
        }
    }
}
```

---

## è¿½åŠ ãƒ‘ãƒƒãƒâ‘¡: SettingsView.swift ãƒœã‚¿ãƒ³ãƒ©ãƒ™ãƒ«ä¿®æ­£

```swift
// å¤‰æ›´å‰
Button("4ï¸âƒ£ 7â†’8ç”¨ï¼ˆãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã ã‘æœªå®Œäº†ï¼‰") {
    appState.setupRecording(pattern: 4)
}

Button("5ï¸âƒ£ å…¨éƒ¨ğŸ”¥30") {
    appState.setupRecording(pattern: 5)
}

// å¤‰æ›´å¾Œ
Button("4ï¸âƒ£ 6â†’7ç”¨ï¼ˆ7æ—¥é”æˆï¼‰") {
    appState.setupRecording(pattern: 4)
}

Button("5ï¸âƒ£ å…¨éƒ¨ğŸª·30") {
    appState.setupRecording(pattern: 5)
}
```

---

## è¿½åŠ ãƒ‘ãƒƒãƒâ‘¢: ProfileView.swift ãƒœã‚¿ãƒ³ãƒ©ãƒ™ãƒ«ä¿®æ­£

```swift
// å¤‰æ›´å‰
Button("5ï¸âƒ£ å…¨éƒ¨ğŸ”¥30") {
    appState.setupRecording(pattern: 5)
}

// å¤‰æ›´å¾Œ
Button("5ï¸âƒ£ å…¨éƒ¨ğŸª·30") {
    appState.setupRecording(pattern: 5)
}
```

---

ä»¥ä¸ŠãŒè¿½åŠ ã§å¿…è¦ãªå·®åˆ†ãƒ‘ãƒƒãƒã§ã™ã€‚