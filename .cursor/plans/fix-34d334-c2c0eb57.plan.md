<!-- c2c0eb57-6bd7-4401-8e8b-afd0563a24a4 8d9b5a85-2ac2-43d6-b46b-478bac8300b0 -->
# UIリフレッシュ（ブルー→モノクロ）とオンボーディング修正＋権限UI反映の擬似パッチ

以下の変更で、Mobbin参照の白黒トーンに統一、オンボーディングの背景・文言、不足していた権限状態の視覚反映を最小改修で実現します。既存レイアウトやロジックは極力温存します。

## 1) グローバルTint（青→黒）

- 目的: ボタン/トグル/リンクなどのアクセント色をモノクロ（黒系）に統一
- 方法: `AppTheme.Colors.accent` を黒に固定（`.accentColor`に依存しない）
```diff
--- a/aniccaios/aniccaios/DesignSystem/AppTheme.swift
+++ b/aniccaios/aniccaios/DesignSystem/AppTheme.swift
@@
-        static let accent: Color = .accentColor
+        // Global accent (monochrome)
+        static let accent: Color = Color(hex: "#222222")
```

- すでに `aniccaiosApp.swift` で `.tint(AppTheme.Colors.accent)` を適用済みのため、アプリ全体の青味が黒系に変わります。

## 2) オンボーディング Welcome 文言キー修正（キー欠落のためキー名が表示される不具合）

- 目的: "Onboarding Welcome Description" のようなキー文字列がそのまま表示される問題を解消
- 原因: `WelcomeStepView` が `onboarding_welcome_description` を参照しているが、`Localizable.strings` には `onboarding_welcome_subtitle` が存在
- 対応: 既存のキーに合わせてView側を修正
```diff
--- a/aniccaios/aniccaios/Onboarding/WelcomeStepView.swift
+++ b/aniccaios/aniccaios/Onboarding/WelcomeStepView.swift
@@
-            Text("onboarding_welcome_description")
+            Text("onboarding_welcome_subtitle")
                 .font(.subheadline)
                 .foregroundStyle(.secondary)
                 .multilineTextAlignment(.center)
                 .padding(.horizontal)
```


（代替案）ローカライズファイルに `onboarding_welcome_description` を追加でも可。ただし今回は差分最小のためView側で既存キーに寄せます。

## 3) オンボーディング背景の全画面適用（ベージュが狭い範囲にしか出ない問題）

- 目的: 各ステップごとの `.background(AppBackground())` だとコンテンツサイズ分に限定される場合があるため、フロー全体で全面背景を敷く
- 対応: `OnboardingFlowView` で背景を包括的に適用 + コンテンツを画面一杯に拡張
```diff
--- a/aniccaios/aniccaios/Onboarding/OnboardingFlowView.swift
+++ b/aniccaios/aniccaios/Onboarding/OnboardingFlowView.swift
@@
-    var body: some View {
-        Group {
-            switch step {
+    var body: some View {
+        ZStack {
+            AppBackground()
+            Group {
+                switch step {
                 case .welcome:
                     WelcomeStepView(next: advance)
                 case .microphone:
                     MicrophonePermissionStepView(next: advance)
                 case .notifications:
                     NotificationPermissionStepView(next: advance)
                 case .account:
                     AuthenticationStepView(next: advance)
                 case .habitSetup:
                     HabitSetupStepView(next: advance)
                 case .habitWakeLocation:
                     HabitWakeLocationStepView(next: advance)
                 case .habitSleepLocation:
                     HabitSleepLocationStepView(next: advance)
                 case .habitTrainingFocus:
                     HabitTrainingFocusStepView(next: advance)
                 case .paywall:
                     PaywallStepView(next: advance)
                 case .completion:
                     CompletionStepView(next: advance)
-            }
-        }
+                }
+            }
+            .frame(maxWidth: .infinity, maxHeight: .infinity)
+        }
         .onAppear {
             // （既存ロジックそのまま）
         }
     }
```


※ 各ステップに残る `.background(AppBackground())` は冪等（重複しても実害なし）。必要なら追って削除できますが、まずは全体背景を優先して不具合解消。

## 4) マイク/通知の許可状態をUIに反映（ONにしても見た目が変わらない）

- 目的: 許可後に状態が分かる視覚フィードバック（黒白基調）
- 方法: 許可済みならステータス表示＋ボタン無効化（ラベル変更・スタイル変更）。拒否済みならステータスを表示。

### 4-1) マイク

```diff
--- a/aniccaios/aniccaios/Onboarding/MicrophonePermissionStepView.swift
+++ b/aniccaios/aniccaios/Onboarding/MicrophonePermissionStepView.swift
@@
         VStack(spacing: 24) {
@@
-            PrimaryButton(
-                title: isRequesting
-                    ? String(localized: "common_requesting")
-                    : String(localized: "common_continue"),
-                isEnabled: !isRequesting,
-                isLoading: isRequesting
-            ) { requestMicrophone() }
+            if micGranted {
+                // 許可済み: ステータスを表示しボタンは無効
+                Label(String(localized: "common_enabled"), systemImage: "checkmark.circle")
+                    .font(.subheadline)
+                    .foregroundStyle(AppTheme.Colors.label)
+                PrimaryButton(
+                    title: String(localized: "common_enabled"),
+                    isEnabled: false,
+                    isLoading: false,
+                    style: .selected
+                ) { }
+            } else {
+                PrimaryButton(
+                    title: isRequesting
+                        ? String(localized: "common_requesting")
+                        : String(localized: "common_continue"),
+                    isEnabled: !isRequesting,
+                    isLoading: isRequesting
+                ) { requestMicrophone() }
+            }
         }
@@
         .onAppear {
             updatePermissionSnapshot()
-            if micGranted {
-                // Auto-advance if already granted
-                DispatchQueue.main.asyncAfter(deadline: .now() + 0.5) {
-                    next()
-                }
-            }
+            // 既に許可されている場合はUIで明示しつつ、自動遷移は保持
+            if micGranted {
+                DispatchQueue.main.asyncAfter(deadline: .now() + 0.5) { next() }
+            }
         }
```

### 4-2) 通知

```diff
--- a/aniccaios/aniccaios/Onboarding/NotificationPermissionStepView.swift
+++ b/aniccaios/aniccaios/Onboarding/NotificationPermissionStepView.swift
@@
-            PrimaryButton(
-                title: isRequesting
-                    ? String(localized: "common_requesting")
-                    : String(localized: "common_continue"),
-                isEnabled: !isRequesting,
-                isLoading: isRequesting
-            ) { requestNotifications() }
+            if notificationGranted {
+                Label(String(localized: "common_enabled"), systemImage: "checkmark.circle")
+                    .font(.subheadline)
+                    .foregroundStyle(AppTheme.Colors.label)
+                PrimaryButton(
+                    title: String(localized: "common_enabled"),
+                    isEnabled: false,
+                    isLoading: false,
+                    style: .selected
+                ) { }
+            } else {
+                PrimaryButton(
+                    title: isRequesting
+                        ? String(localized: "common_requesting")
+                        : String(localized: "common_continue"),
+                    isEnabled: !isRequesting,
+                    isLoading: isRequesting
+                ) { requestNotifications() }
+            }
@@
-        .onAppear {
-            Task { await refreshAuthorizationState(autoAdvance: true) }
-        }
+        .onAppear {
+            Task { await refreshAuthorizationState(autoAdvance: true) }
+        }
```

（補足）拒否済みのときに「設定を開く」を出すなどの分岐も可能ですが、まずは「許可済みが見て分かる」ことを優先しています。

---

## 5) 参考（既出の型不一致修正）

- `SectionRow`の`some View`→`Content`不一致は、先の計画通り`AnyView`での型消去＋非ジェネリック化で解消済み方針です（別パッチ）。

## 実装後の確認

- ボタン/トグル/リンクの青味が黒系に統一されている
- Welcomeのサブタイトルが正しくローカライズ表示
- オンボーディング全画面がベージュ背景で覆われる
- マイク/通知許可後に“Enabled”表示・ボタン無効化（黒白基調）

### To-dos

- [ ] AppTheme.accentを黒に変更して全体tintを統一
- [ ] WelcomeStepViewのローカライズキーをsubtitleへ修正
- [ ] OnboardingFlowViewに全面AppBackgroundを適用する
- [ ] MicrophonePermissionStepViewに許可済み表示とボタン無効化
- [ ] NotificationPermissionStepViewに許可済み表示とボタン無効化
- [ ] ビルドして色・背景・権限表示を確認