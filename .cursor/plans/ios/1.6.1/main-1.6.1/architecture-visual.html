<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anicca 1.6.1 Architecture</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        h1 {
            text-align: center;
            color: #ffd700;
            margin-bottom: 10px;
        }
        h2 {
            text-align: center;
            color: #888;
            font-weight: normal;
            margin-top: 0;
        }
        .mermaid {
            background: #0d1117;
            border-radius: 16px;
            padding: 30px;
            margin: 20px auto;
            max-width: 1400px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .section {
            margin: 40px auto;
            max-width: 1400px;
        }
        .section h3 {
            color: #ffd700;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 10px;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .info-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .info-card h4 {
            color: #ffd700;
            margin-top: 0;
        }
        .info-card p {
            margin: 5px 0;
            color: #aaa;
        }
        .info-card code {
            background: rgba(255,215,0,0.1);
            color: #ffd700;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }
        .status-done { color: #4ade80; }
        .status-new { color: #60a5fa; }
    </style>
</head>
<body>
    <h1>ğŸ™ Anicca 1.6.1 Architecture</h1>
    <h2>ã€Œå…¨ã¦ã®ç”Ÿãã¨ã—ç”Ÿã‘ã‚‹ã‚‚ã®ã®è‹¦ã—ã¿ã‚’çµ‚ã‚ã‚‰ã›ã‚‹ã€</h2>

    <div class="mermaid">
flowchart TB
    subgraph VPS["ğŸ–¥ï¸ Hetzner VPS (OpenClaw) â€” NEW in 1.6.1"]
        direction TB
        SOUL["ğŸ“œ SOUL.md\nãƒšãƒ«ã‚½ãƒŠå®šç¾©"]
        ENV["ğŸ” .env\nAPI Keys"]
        
        subgraph Skills["âš¡ Skills"]
            MR["ğŸ” moltbook-responder\nè‹¦ã—ã¿æ¤œå‡º â†’ Nudgeè¿”ä¿¡"]
            SR["ğŸ“… slack-reminder\næœˆæ›œ #meeting\nå±æ©Ÿ #metrics"]
            FF["ğŸ“Š feedback-fetch\nupvotesåé›†"]
        end
    end
    
    subgraph Railway["ğŸš‚ Railway API (Backend)"]
        direction TB
        subgraph AgentAPI["Agent API â€” NEW in 1.6.1"]
            AN["/agent/nudge"]
            AW["/agent/wisdom"]
            AF["/agent/feedback"]
            AP["/agent/posts"]
            AC["/agent/content"]
        end
        
        subgraph MobileAPI["Mobile API â€” Existing"]
            MN["/mobile/nudge"]
            MP["/mobile/profile"]
        end
        
        subgraph DB["ğŸ’¾ PostgreSQL"]
            AGP["agent_posts\nâ€” NEW"]
            HC["hook_candidates"]
            US["unified_score"]
        end
    end
    
    subgraph GHA["âš™ï¸ GitHub Actions"]
        TT["ğŸµ TikTok Agent\nPython / æ¯æ—¥æŠ•ç¨¿"]
        DM["ğŸ“ˆ Daily Metrics\nASC/Mixpanel"]
    end
    
    subgraph RailwayCron["â° Railway Cron"]
        LLM["ğŸ¤– LLM Nudgeç”Ÿæˆ\næ¯æ—¥å®Ÿè¡Œ"]
    end
    
    subgraph App["ğŸ“± iOS App"]
        PNS["ğŸ”” Notification\nScheduler"]
        LN["ğŸ’¡ LLM Nudge\næ—¥æ¬¡å–å¾—"]
        FB["ğŸ‘ğŸ‘ Feedback"]
    end
    
    subgraph External["ğŸŒ External Platforms"]
        Moltbook["ğŸ¦ Moltbook\nAI SNS"]
        Slack["ğŸ’¬ Slack\n#meeting #metrics"]
        TikTok["ğŸ“¹ TikTok"]
    end
    
    %% VPS connections
    MR --> Moltbook
    SR --> Slack
    FF --> AF
    
    %% GHA connections
    TT --> TikTok
    TikTok -.->|views/likes| AF
    
    %% Railway Cron
    LLM --> MN
    MN --> LN
    
    %% App connections
    FB --> MobileAPI
    
    %% Feedback loop
    Moltbook -.->|upvotes| FF
    AF --> AGP
    AGP --> HC
    HC -.->|é«˜ã‚¹ã‚³ã‚¢æ˜‡æ ¼| AN

    style VPS fill:#1e3a5f,stroke:#60a5fa,stroke-width:2px
    style Railway fill:#2d1f4e,stroke:#a78bfa,stroke-width:2px
    style GHA fill:#1f2937,stroke:#9ca3af,stroke-width:2px
    style App fill:#14532d,stroke:#4ade80,stroke-width:2px
    style External fill:#4a1d1d,stroke:#f87171,stroke-width:2px
    </div>

    <div class="section">
        <h3>ğŸ“Š Platform Status</h3>
        <div class="info-grid">
            <div class="info-card">
                <h4>ğŸ“± iOS App</h4>
                <p><span class="status-done">âœ… Existing</span></p>
                <p>Railway Cron â†’ LLM Nudge ç”Ÿæˆ</p>
                <p>æ¯æ—¥å®Ÿè¡Œ</p>
            </div>
            <div class="info-card">
                <h4>ğŸ“¹ TikTok</h4>
                <p><span class="status-done">âœ… Existing</span></p>
                <p>GitHub Actions â†’ Python Agent</p>
                <p>æ¯æ—¥ Nudge å‹•ç”»æŠ•ç¨¿</p>
            </div>
            <div class="info-card">
                <h4>ğŸ¦ Moltbook</h4>
                <p><span class="status-new">ğŸ†• NEW in 1.6.1</span></p>
                <p>Hetzner VPS â†’ moltbook-responder</p>
                <p>è‹¦ã—ã¿æ¤œå‡º â†’ Nudge è¿”ä¿¡</p>
            </div>
            <div class="info-card">
                <h4>ğŸ’¬ Slack</h4>
                <p><span class="status-new">ğŸ†• NEW in 1.6.1</span></p>
                <p>Hetzner VPS â†’ slack-reminder</p>
                <p>æœˆæ›œ #meeting / å±æ©Ÿ #metrics</p>
            </div>
        </div>
    </div>

    <div class="section">
        <h3>ğŸ”‘ API Keys & Credentials</h3>
        <div class="info-grid">
            <div class="info-card">
                <h4>Moltbook</h4>
                <p>Agent: <code>anicca-wisdom</code></p>
                <p>Submolt: <code>m/endingsuffering</code></p>
                <p>Status: <span class="status-done">âœ… Claimed</span></p>
            </div>
            <div class="info-card">
                <h4>VPS</h4>
                <p>IP: <code>46.225.70.241</code></p>
                <p>User: <code>anicca</code></p>
                <p>Env: <code>~/.env</code></p>
            </div>
            <div class="info-card">
                <h4>Railway</h4>
                <p>Staging: <code>anicca-proxy-staging</code></p>
                <p>Production: <code>anicca-proxy-production</code></p>
            </div>
        </div>
    </div>

    <div class="section">
        <h3>ğŸ”„ Learning Loop (Wisdom)</h3>
        <div class="mermaid">
flowchart LR
    A["ğŸ“Š Data Collection"] --> B["ğŸ“ˆ Z-Scoreçµ±åˆ"]
    B --> C["â­ hook_candidatesæ˜‡æ ¼"]
    C --> D["ğŸ¤– æ¬¡ã®Nudgeç”Ÿæˆ"]
    D --> A
    
    subgraph Sources["Data Sources"]
        S1["TikTok views/likes"]
        S2["App ğŸ‘ğŸ‘"]
        S3["Moltbook upvotes"]
    end
    
    Sources --> A

    style A fill:#1e3a5f,stroke:#60a5fa
    style B fill:#2d1f4e,stroke:#a78bfa
    style C fill:#14532d,stroke:#4ade80
    style D fill:#4a1d1d,stroke:#f87171
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'dark',
            flowchart: {
                curve: 'basis',
                padding: 20
            }
        });
    </script>
</body>
</html>
