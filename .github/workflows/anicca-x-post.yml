name: Anicca X Post

on:
  schedule:
    - cron: '50 23 * * *'  # 08:50 JST (morning slot)
    - cron: '50 11 * * *'  # 20:50 JST (evening slot)
  workflow_dispatch:
    inputs:
      slot:
        description: 'Slot to post'
        required: false
        default: 'morning'
        type: choice
        options:
          - morning
          - evening

permissions:
  contents: read

concurrency:
  group: anicca-x-post
  cancel-in-progress: false

env:
  OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
  BLOTATO_API_KEY: ${{ secrets.BLOTATO_API_KEY }}
  API_BASE_URL: ${{ secrets.API_BASE_URL }}
  API_AUTH_TOKEN: ${{ secrets.API_AUTH_TOKEN }}
  X_ACCOUNT_ID: ${{ secrets.X_ACCOUNT_ID }}
  POST_SLOT: ${{ inputs.slot || (github.event.schedule == '50 23 * * *' && 'morning' || 'evening') }}

jobs:
  post:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install dependencies
        run: pip install -r scripts/x-agent/requirements.txt

      - name: Run X Agent
        working-directory: scripts/x-agent
        run: python anicca_x_agent.py
