# タスク完了時のチェックリスト

## 必須実行項目

### 1. TDD実践チェック（最優先）
```bash
# テスト実行と結果確認
npm test                    # 全テストが通過することを確認
npm run test:coverage      # カバレッジ確認（存在する場合）

# エージェント実行確認
# - test-automation-engineer が起動されたか
# - code-quality-reviewer でレビューされたか
```

#### TDD品質チェック項目
- [ ] **Red-Green-Refactor**サイクルが実践された
- [ ] テストが先に作成され、実装後に通過している
- [ ] 入出力ペアが明確に定義されている
- [ ] エッジケース（境界値・異常値）がテストされている
- [ ] モック実装ではなく実際に動作するコードが実装されている
- [ ] テストがコードに過度に最適化されていない（汎用性がある）

### 2. 実装前チェック（TDD追加）
- [ ] **Context7**でドキュメント調査を実施した
- [ ] **Serena**で既存コードパターンを確認した
- [ ] 全ての疑問点が解消されている（「可能性がある」「のはず」なし）
- [ ] 完全なコードをユーザーに提示してから実装した
- [ ] プロンプトでゴミロジック（`includes()`等）を使用していない

### 3. コード品質チェック（最重要）
```bash
# ESLintでコードスタイルチェック
npm run lint

# Prettierで自動フォーマット
npm run format
```

### 4. TypeScriptコンパイル確認
```bash
# デスクトップアプリの場合
npm run build:voice

# プロキシサーバーの場合（TypeScript使用時）
cd anicca-proxy-slack
tsc --noEmit  # 型チェックのみ

# Webアプリの場合
cd anicca-web
npm run build
```

### 5. テスト実行（存在する場合）
```bash
# Jestテスト（デスクトップアプリ）
npm test

# その他のテストコマンドがあれば実行
```

### 6. 動作確認
```bash
# デスクトップアプリ
npm run voice:simple  # 実際に起動して動作確認

# プロキシサーバー
cd anicca-proxy-slack
npm run dev  # ローカルで動作確認

# Webアプリ
cd anicca-web
npm run dev  # ブラウザで動作確認
```

## コミット前のチェック項目

### セキュリティチェック
- [ ] APIキーやシークレットがハードコーディングされていない
- [ ] 環境変数や暗号化ストレージを使用している
- [ ] センシティブな情報がログ出力されていない
- [ ] **Railway環境変数**で適切に管理されている

### コード規約チェック（TDD拡張）
- [ ] フルパスのハードコーディングがない
- [ ] マジックナンバーが定数化されている
- [ ] 適切なエラーハンドリングが実装されている
- [ ] TypeScriptの型が適切に定義されている
- [ ] **優柔不断な実装**（選択肢提示）をしていない
- [ ] **最適解を決定**し、根拠を説明している

### ファイル整理
- [ ] 不要なコメントアウトコードを削除
- [ ] console.logデバッグ文を削除（必要なログは残す）
- [ ] 一時ファイルを削除

## TDD専用チェック項目

### テスト品質確認
- [ ] **実装がテストに依存しすぎていない**（汎用性確保）
- [ ] **境界値テスト**が含まれている
- [ ] **異常値テスト**が含まれている
- [ ] **統合テスト**も考慮されている
- [ ] テストの**可読性**が高い（何をテストしているか明確）

### 実装品質確認
- [ ] **拡張性**を考慮した設計になっている
- [ ] **可読性**が高いコードになっている
- [ ] **保守性**を考慮した実装になっている
- [ ] **パフォーマンス**に問題がない

### プロセス確認
- [ ] **方向転換**をせずに計画通り実装した
- [ ] **不明点**が出た際は実装を停止して質問した
- [ ] **Memory**に重要な決定事項を記録した

## エージェント実行確認
- [ ] `test-automation-engineer`エージェントが適切に起動された
- [ ] `code-quality-reviewer`エージェントでレビューされた
- [ ] 指摘事項がある場合は適切に対応した

## DMGビルド前の特別チェック

```bash
# 1. マウント済みDMGの確認と解除
ls /Volumes/
hdiutil detach "/Volumes/Anicca*" -force

# 2. ビルドキャッシュのクリア（必要時）
rm -rf dist/
npm run clean-build

# 3. 本番ビルド実行
npm run dist:voice
```

## トラブルシューティング

### ビルドエラー時
1. `node_modules`削除と再インストール
   ```bash
   rm -rf node_modules package-lock.json
   npm install
   ```

2. TypeScriptキャッシュクリア
   ```bash
   rm -rf dist/
   tsc --build --clean
   ```

### ポート競合時
```bash
# 使用中のポート確認
lsof -i :3838  # デスクトップアプリ
lsof -i :3000  # Webアプリ

# プロセス終了
kill -9 [PID]
```

## 最終確認
- [ ] すべてのlintエラーが解決済み
- [ ] ビルドが成功する
- [ ] **テストが全て通過**する
- [ ] 基本機能が正常に動作する
- [ ] 新機能・修正が意図通りに動作する
- [ ] **TDDサイクル**が完了している
- [ ] CLAUDE.mdの更新が必要か確認

## 注意事項
- **音声版が主力製品** - UI版の変更は慎重に
- **プライバシー優先** - データはローカル保存が原則
- **後方互換性** - 既存機能を壊さない
- **テスト重視** - 本番環境に影響する変更は特に慎重に
- **TDD原則** - テスト→実装→リファクタリング→レビューの順守