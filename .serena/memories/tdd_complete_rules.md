# TDD実践規約（完全版）

## TDDワークフローの原則

### 基本サイクル
```
1. Red（テスト失敗）→ 2. Green（最小実装）→ 3. Refactor（リファクタリング）→ 4. Review（品質確認）
```

### プロセス自動化
1. **テスト作成時**: 入出力ペアを明確化して期待値を具体的に定義
2. **テスト作成後**: 自動で`test-automation-engineer`エージェント起動
3. **実装完了後**: `code-quality-reviewer`エージェントで品質チェック
4. **最終段階**: lint/typecheckコマンド自動実行

## 意思決定の原則（絶対厳守）

### 優柔不断の完全禁止
- **❌ 絶対NG**: 「どれがいいですか？」「選択肢A、B、Cがあります」
- **✅ 正解**: 拡張性・可読性を考慮し、明確に最適解を決定
- **理由**: ユーザーの時間を奪わず、専門知識を活用した決断を行う

### 決定基準
1. 拡張性（将来の機能追加への対応）
2. 可読性（コードの理解しやすさ）
3. 保守性（メンテナンスの容易さ）
4. パフォーマンス（実行効率）
5. セキュリティ（安全性）

## コミュニケーション規則

### 日本語厳守
- 全ての応答・思考過程を日本語で記述
- CoT（Chain of Thought）も含めて完全に日本語

### 視覚的説明の自動提供
ユーザーが求めていなくても、以下を自動的に提示：

#### フロー図
```
データ入力 → バリデーション → 処理実行 → 結果出力
     ↓           ↓           ↓           ↓
   型チェック   エラー処理   ログ記録   レスポンス生成
```

#### ディレクトリ構造
```
src/
├── agents/
│   ├── mainAgent.ts
│   │   ├── handleTask()
│   │   └── processVoice()
│   └── sessionManager.ts
└── services/
    ├── voiceService.ts
    └── slackService.ts
```

## プロンプト作成規約（重要）

### AIエージェントへの指示でのゴミロジック禁止
- **❌ 絶対NG**: `if (task.includes('起床')) { prompt = '起こして' }`
- **❌ 絶対NG**: `${task.includes('起床') ? 'wake' : 'sleep'}`
- **✅ 正解**: `「${task}を実行してください。起床タスクなら起こして、就寝タスクなら寝かせて」`

### 理由
- AIエージェントは自然言語を完全に理解可能
- 条件分岐は不要で、かえってバグの原因となる
- プロンプトエンジニアリングで解決すべき

## 実装前の完全性確保

### 疑問点の完全解消
1. **Context7でドキュメント調査**: 最新仕様の確認
2. **Serenaでコード確認**: 既存実装パターンの把握
3. **全疑問点のクリア**: 「可能性がある」「のはず」は禁止
4. **完全コード提示**: 実装前に完成形をユーザーに提示

### 実装中の行動規範
- **モック実装禁止**: 動作しない仮実装は絶対NG
- **方向転換禁止**: 計画通りに実装、問題があれば立ち止まって相談
- **独自実装での誤魔化し禁止**: わからない場合は必ずユーザーに質問

## セキュリティ・品質規則

### APIキー管理
- **直書き完全禁止**: ソースコードにAPIキーを記述しない
- **Railway環境変数**: anicca-proxy-slackのデプロイ先で管理
- **新規キー**: 必要な場合はユーザーに追加依頼

### パス管理
- **❌ フルパス禁止**: `/Users/username/project/`
- **✅ 相対パス使用**: `path.join(__dirname, '../')`、`Path.cwd()`

### 定数化
- **マジックナンバー禁止**: 数値は定数として定義
- **設定値の外部化**: 環境変数や設定ファイルから取得

## ツール使用の必須ルール

### Serena使用の義務化
- **コード読み取り**: 必ずSerenaの`find_symbol`、`get_symbols_overview`使用
- **コード編集**: 必ずSerenaの`replace_symbol_body`、`insert_after_symbol`使用
- **例外**: Serenaが使用できない場合のみ直接操作

### Context7活用
- **ドキュメント調査**: 最新の公式ドキュメント取得
- **仕様確認**: ライブラリ・フレームワークの正確な使用方法確認

### Memory管理
- 重要な決定事項・パターンをSerenaメモリーに保存
- プロジェクト固有ルールの蓄積
- 過去の実装方針との一貫性確保

## 品質保証プロセス

### テスト要件
- **入出力ペア**: 具体的なテストケース定義
- **エッジケース**: 境界値・異常値のテスト
- **モック禁止**: 実際に動作するテストのみ

### 実装後チェック
- **ESLint**: コードスタイルチェック
- **TypeScript**: 型チェック
- **動作確認**: 実際の動作テスト
- **セキュリティ**: 脆弱性チェック

この規約により、決断力があり、説明が明確で、品質の高いTDD実践が確実に実行されます。