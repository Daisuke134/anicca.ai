# Anicca iOS é–‹ç™ºã‚¬ã‚¤ãƒ‰ - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‘ã‘

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€iOSãƒ—ãƒ­ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–‹ç™ºã®ãŸã‚ã®ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚

---

## æœ€é‡è¦ãƒ«ãƒ¼ãƒ«ï¼ˆå¿…ãšæœ€åˆã«èª­ã‚€ã“ã¨ï¼‰

### 1. æ„æ€æ±ºå®šãƒ«ãƒ¼ãƒ«
**ã€Œã©ã¡ã‚‰ãŒã„ã„ã§ã™ã‹ï¼Ÿã€ã¨èããªã€‚è‡ªåˆ†ã§æ±ºã‚ã‚ã€‚**

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ä»¥ä¸‹ã®æ‰‹é †ã§æ„æ€æ±ºå®šã‚’è¡Œã†ã“ã¨ï¼š
1. **ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’èª¿æŸ»ã™ã‚‹**
2. **è‡ªåˆ†ã§æ±ºå®šã™ã‚‹**
3. **ç†ç”±ã‚’èª¬æ˜ã™ã‚‹**

**ç¦æ­¢äº‹é …:**
- ã€ŒAã¨Bã©ã¡ã‚‰ãŒã„ã„ã§ã™ã‹ï¼Ÿã€ã®ã‚ˆã†ãªè³ªå•
- è¤‡æ•°ã®é¸æŠè‚¢æç¤ºã§é¸ã°ã›ã‚‹ã“ã¨

### 2. ãƒ¡ãƒ¢ãƒªä½¿ç”¨ãƒ«ãƒ¼ãƒ«
**é‡è¦ãªæƒ…å ±ã¯è¨€ã‚ã‚Œãªãã¦ã‚‚è‡ªç™ºçš„ã«ãƒ¡ãƒ¢ãƒªã«ä¿å­˜ã™ã‚‹ã“ã¨ã€‚**

- ä¾¡æ ¼ã€è¨­å®šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¥½ã¿ã¯å³åº§ã«ä¿å­˜
- Cursorã®`update_memory`ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨

### 3. AniccaåŸºæœ¬æƒ…å ±
- **ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ä¾¡æ ¼**: æœˆé¡$9.99ã€å¹´é¡$49.99ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- **TikTok SKANè¨­å®š**: CV1=Launch Appã€CV2=æœˆé¡$9-10ã€CV3=å¹´é¡$49-50

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### Aniccaã¨ã¯
Aniccaã¯ã€iOSã§å‹•ä½œã™ã‚‹ãƒ—ãƒ­ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªè¡Œå‹•å¤‰å®¹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚  
é€šçŸ¥ã¨Nudge Cardã‚’ä¸­å¿ƒã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã€Œè‹¦ã—ã¿ã€ã‚’å°ã•ãã™ã‚‹è¨­è¨ˆã§ã™ã€‚

### ãƒªãƒªãƒ¼ã‚¹çŠ¶æ³
| é …ç›® | å†…å®¹ |
|---|---|
| App Storeæ‰¿èª | 1.3.0ï¼ˆPhase 6ï¼‰ |
| æ¬¡å›æå‡º | 1.4.0 |

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | æŠ€è¡“ |
|---|---|
| iOS | Swift / SwiftUI / UserNotifications / StoreKit |
| é€šçŸ¥ãƒ»Nudge | ProblemTypeãƒ™ãƒ¼ã‚¹é€šçŸ¥ã€LLM Nudgeï¼ˆPhase 6ï¼‰ |
| Backend | Node.js / Express / PostgreSQLï¼ˆRailwayï¼‰ |
| èª²é‡‘ | RevenueCat / Superwall |
| åˆ†æ | Mixpanel / Singular |

### ä¸»è¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
| ãƒ‘ã‚¹ | å½¹å‰² |
|---|---|
| `aniccaios/` | iOSã‚¢ãƒ—ãƒªæœ¬ä½“ |
| `apps/api/` | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API |
| `maestro/` | iOS E2Eãƒ†ã‚¹ãƒˆ |
| `docs/` | è¨­è¨ˆãƒ»èª¿æŸ»ãƒ¡ãƒ¢ |
| `.cursor/plans/ios/proactive/roadmap.md` | ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ï¼ˆä»•æ§˜ã®åŸºæº–ï¼‰ |

---

## iOSã‚¢ãƒ—ãƒªã®ä¸»è¦æ©Ÿèƒ½
| æ©Ÿèƒ½ | èª¬æ˜ |
|---|---|
| ProblemTypeãƒ™ãƒ¼ã‚¹ã®Nudge | 13å•é¡Œã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦é€šçŸ¥ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« |
| Nudge Card | é€šçŸ¥ã‚¿ãƒƒãƒ—ã§1ç”»é¢ã®ä»‹å…¥ã€1æŠ/2æŠ + ğŸ‘ğŸ‘ |
| LLMç”ŸæˆNudgeï¼ˆPhase 6ï¼‰ | `/api/mobile/nudge/today` ã‹ã‚‰æ—¥æ¬¡å–å¾— |
| ã‚µãƒ¼ãƒãƒ¼é§†å‹•Nudge | `/api/mobile/nudge/trigger` â†’ å³æ™‚ãƒ­ãƒ¼ã‚«ãƒ«é€šçŸ¥ |
| ã‚»ãƒ³ã‚µãƒ¼é€£æº | ScreenTime / HealthKit é€£æºã®è¨±å¯åŒæœŸ |
| èª²é‡‘/ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ« | RevenueCat + Superwall |
| åˆ†æ | Mixpanel / Singular / è‡ªå‰ãƒ¡ãƒˆãƒªã‚¯ã‚¹ |

---

## ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ•ãƒ­ãƒ¼
| é †åº | ã‚¹ãƒ†ãƒƒãƒ— | View | èª¬æ˜ |
|---|---|---|---|
| 1 | welcome | `WelcomeStepView` | ã‚¢ãƒ—ãƒªç´¹ä»‹ + æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼å¾©å…ƒç”¨ Sign in with Apple |
| 2 | value | `ValueStepView` | ä¾¡å€¤èª¬æ˜ |
| 3 | struggles | `StrugglesStepView` | å•é¡Œã‚¿ã‚¤ãƒ—é¸æŠ |
| 4 | notifications | `NotificationPermissionStepView` | é€šçŸ¥è¨±å¯ |
| 5 | att | `ATTPermissionStepView` | ATTè¨±å¯ â†’ å®Œäº†å‡¦ç† |

---

## é€šçŸ¥ãƒ»Nudgeãƒ•ãƒ­ãƒ¼
| ãƒ•ã‚§ãƒ¼ã‚º | å½¹å‰² | ä¸»ãªã‚¯ãƒ©ã‚¹ |
|---|---|---|
| äºˆç´„é€šçŸ¥ | ProblemTypeã«åŸºã¥ãã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« | `ProblemNotificationScheduler` |
| å³æ™‚é€šçŸ¥ | ã‚µãƒ¼ãƒãƒ¼Nudgeã‚’å³æ™‚è¡¨ç¤º | `NotificationScheduler` |
| è¡¨ç¤º | Nudge Card UI | `NudgeCardView` |
| é¸æŠ/å­¦ç¿’ | åå¿œã‚’è¨˜éŒ²ã—æ¬¡å›ã«åæ˜  | `NudgeStatsManager`, `NudgeContentSelector` |
| LLM Nudge | æ—¥æ¬¡å–å¾—ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | `LLMNudgeService`, `LLMNudgeCache` |

---

## iOSä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | å½¹å‰² | ãƒ‘ã‚¹ |
|---|---|---|
| AppState | èªè¨¼/ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«/è³¼èª­/ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°/NudgeçŠ¶æ…‹ã®ä¸­å¿ƒ | `aniccaios/AppState.swift` |
| ProblemType | 13å•é¡Œã‚¿ã‚¤ãƒ—å®šç¾© | `aniccaios/Models/ProblemType.swift` |
| ProblemNotificationScheduler | ProblemTypeé€šçŸ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« | `aniccaios/Notifications/ProblemNotificationScheduler.swift` |
| NotificationScheduler | ã‚µãƒ¼ãƒãƒ¼Nudgeã®å³æ™‚é€šçŸ¥ | `aniccaios/Notifications/NotificationScheduler.swift` |
| NudgeCardView | ä»‹å…¥UI | `aniccaios/Views/NudgeCardView.swift` |
| NudgeContentSelector | ãƒãƒªã‚¢ãƒ³ãƒˆé¸æŠ | `aniccaios/Services/NudgeContentSelector.swift` |
| NudgeStatsManager | tapped/ignored/ğŸ‘ğŸ‘ã®é›†è¨ˆ | `aniccaios/Services/NudgeStatsManager.swift` |
| LLMNudgeService / Cache | LLM Nudgeå–å¾—ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | `aniccaios/Services/LLMNudgeService.swift`, `LLMNudgeCache.swift` |
| NudgeTriggerService | `/mobile/nudge` APIå‘¼ã³å‡ºã— | `aniccaios/Services/NudgeTriggerService.swift` |
| ProfileSyncService | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«åŒæœŸ | `aniccaios/Services/ProfileSyncService.swift` |
| SubscriptionManager | è³¼èª­çŠ¶æ…‹åŒæœŸ | `aniccaios/Services/SubscriptionManager.swift` |
| SensorAccessSyncService | ã‚»ãƒ³ã‚µãƒ¼è¨±å¯åŒæœŸ | `aniccaios/Services/SensorAccessSyncService.swift` |

---

## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰
| ãƒ«ãƒ¼ãƒˆ | å½¹å‰² | å®Ÿè£… |
|---|---|---|
| `/api/mobile/profile` | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—/æ›´æ–° | `apps/api/src/routes/mobile/profile.js` |
| `/api/mobile/entitlement` | è³¼èª­/åˆ©ç”¨é‡ | `apps/api/src/routes/mobile/entitlement.js` |
| `/api/mobile/nudge` | ãƒˆãƒªã‚¬ãƒ¼/ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯/ä»Šæ—¥ã®LLM | `apps/api/src/routes/mobile/nudge.js` |
| `/api/mobile/behavior` | è¡Œå‹•ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡ | `apps/api/src/routes/mobile/behavior.js` |
| `/api/mobile/feeling` | æ„Ÿæƒ…ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡ | `apps/api/src/routes/mobile/feeling.js` |
| `/api/mobile/daily_metrics` | ãƒ‡ã‚¤ãƒªãƒ¼ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | `apps/api/src/routes/mobile/dailyMetrics.js` |
| `/api/mobile/sensors` | ã‚»ãƒ³ã‚µãƒ¼æ¨©é™/çŠ¶æ…‹åŒæœŸ | `apps/api/src/routes/mobile/sensors.js` |
| `/api/mobile/account` | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç† | `apps/api/src/routes/mobile/account.js` |

---

## ç’°å¢ƒå¤‰æ•°ãƒ»è¨­å®šï¼ˆiOSï¼‰
| ã‚­ãƒ¼ | èª¬æ˜ |
|---|---|
| `ANICCA_PROXY_BASE_URL` | APIãƒ™ãƒ¼ã‚¹URL |
| `REVENUECAT_API_KEY` | RevenueCat APIã‚­ãƒ¼ |
| `REVENUECAT_ENTITLEMENT_ID` | ã‚¨ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ãƒ¡ãƒ³ãƒˆID |
| `REVENUECAT_PAYWALL_ID` | Paywall ID |
| `REVENUECAT_CUSTOMER_CENTER_ID` | Customer Center ID |

---

## ãƒ†ã‚¹ãƒˆ
| ç¨®åˆ¥ | ãƒ‘ã‚¹ | ã‚³ãƒãƒ³ãƒ‰ä¾‹ |
|---|---|---|
| Unit/Integration | `aniccaios/aniccaiosTests/` | `xcodebuild test ... -only-testing:aniccaiosTests` |
| E2E | `maestro/` | `maestro test maestro/` |

---

## FAQ
| è³ªå• | å›ç­” |
|---|---|
| æ–°ã—ã„ProblemTypeã‚’è¿½åŠ ã™ã‚‹ã«ã¯ï¼Ÿ | `Models/ProblemType.swift` ã«caseè¿½åŠ  â†’ `Localizable.strings` ã®è¡¨ç¤ºå/ãƒœã‚¿ãƒ³æ–‡è¨€è¿½åŠ  â†’ å¿…è¦ã«å¿œã˜ã¦ `Resources/Prompts/` æ›´æ–° |
| æ–°ã—ã„APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹ã«ã¯ï¼Ÿ | `apps/api/src/routes/mobile/` ã«ãƒ«ãƒ¼ã‚¿è¿½åŠ  â†’ `mobile/index.js` ã«ç™»éŒ² |
| é€šçŸ¥æ–‡è¨€ã‚’è¿½åŠ ã™ã‚‹ã«ã¯ï¼Ÿ | `Localizable.strings` ã® `nudge_*` ã‚­ãƒ¼ã‚’è¿½åŠ ã—ã€`ProblemType.notificationVariantCount` ã¨æ•´åˆã•ã›ã‚‹ |

---

**æœ€çµ‚æ›´æ–°**: 2026-01-26
