# Onboarding Flow Test
# Tests the complete onboarding flow from first launch to main screen
# Note: Uses text-based taps (no accessibilityIdentifier required)

appId: ai.anicca.app.ios
name: Onboarding flow

---
# Clean start - delete app to simulate first launch
- clearState

# Launch the app
- launchApp

# Step 1: Welcome screen
- assertVisible:
    text: "Anicca"
    timeout: 10000

- assertVisible:
    text: "Get started"

- tapOn:
    text: "Get started"

# Step 2: Ideals - "Who do you want to become?"
- assertVisible:
    text: "Who do you want to become?"
    timeout: 5000

# Select a trait (optional) and tap Next
- tapOn:
    text: "Next"
    optional: true

- tapOn:
    text: "Skip"
    optional: true

# Step 3: Struggles - "What are you struggling with right now?"
- assertVisible:
    text: "What are you struggling with"
    timeout: 5000

- tapOn:
    text: "Next"
    optional: true

- tapOn:
    text: "Skip"
    optional: true

# Step 4: Value - "What Anicca can do for you"
- assertVisible:
    text: "What Anicca can do for you"
    timeout: 5000

- tapOn:
    text: "Continue"

# Step 5: Account - Sign in with Apple
# Note: In CI/testing, we may need to skip this or use a test account
- assertVisible:
    text: "Sign in with Apple"
    timeout: 5000

# For E2E testing, we'll tap the Sign in with Apple button
# The system will show the Apple sign-in dialog
- tapOn:
    text: "Sign in with Apple"

# Handle Apple Sign In dialog (simulator may show different UI)
- tapOn:
    text: "Continue"
    optional: true
    timeout: 3000

# Step 6: Microphone permission
- assertVisible:
    text: "Microphone"
    timeout: 10000

- tapOn:
    text: "Allow microphone"

# Handle iOS permission dialog
- tapOn:
    text: "Allow"
    optional: true
    timeout: 3000

- tapOn:
    text: "OK"
    optional: true
    timeout: 3000

# Step 7: Notifications permission
- assertVisible:
    text: "Notifications"
    timeout: 5000

- tapOn:
    text: "Allow notifications"

# Handle iOS permission dialog
- tapOn:
    text: "Allow"
    optional: true
    timeout: 3000

# After notifications, onboarding should be complete
# Main screen should show the Talk tab
- assertVisible:
    text: "Talk"
    timeout: 10000

- assertVisible:
    text: "Consult Anicca"
    optional: true

