# Onboarding Flow Test
# Tests the complete onboarding flow from first launch to main screen
# Note: Uses text-based taps (no accessibilityIdentifier required)

appId: ai.anicca.app.ios
name: Onboarding flow

---
# Clean start - delete app to simulate first launch
- clearState

# Launch the app
- launchApp

# Step 1: Welcome screen
- extendedWaitUntil:
    visible: "Anicca"
    timeout: 10000

- assertVisible: "Get started"

- tapOn: "Get started"

# Step 2: Ideals - "Who do you want to become?"
- extendedWaitUntil:
    visible: "Who do you want to become?"
    timeout: 5000

# Select a trait (optional) and tap Next
- tapOn:
    text: "Next"
    optional: true

- tapOn:
    text: "Skip"
    optional: true

# Step 3: Struggles - "What are you struggling with right now?"
- extendedWaitUntil:
    visible: "What are you struggling with"
    timeout: 5000

- tapOn:
    text: "Next"
    optional: true

- tapOn:
    text: "Skip"
    optional: true

# Step 4: Value - "What Anicca can do for you"
- extendedWaitUntil:
    visible: "What Anicca can do for you"
    timeout: 5000

- tapOn: "Continue"

# Step 5: Account - Sign in with Apple
- extendedWaitUntil:
    visible: "Sign in with Apple"
    timeout: 5000

# For E2E testing, we'll tap the Sign in with Apple button
- tapOn: "Sign in with Apple"

# Handle Apple Sign In dialog (simulator may show different UI)
- tapOn:
    text: "Continue"
    optional: true

# Step 6: Microphone permission
- extendedWaitUntil:
    visible: "Microphone"
    timeout: 10000

- tapOn: "Allow microphone"

# Handle iOS permission dialog
- tapOn:
    text: "Allow"
    optional: true

- tapOn:
    text: "OK"
    optional: true

# Step 7: Notifications permission
- extendedWaitUntil:
    visible: "Notifications"
    timeout: 5000

- tapOn: "Allow notifications"

# Handle iOS permission dialog
- tapOn:
    text: "Allow"
    optional: true

# After notifications, onboarding should be complete
# Main screen should show the Talk tab
- extendedWaitUntil:
    visible: "Talk"
    timeout: 10000

- assertVisible:
    text: "Consult Anicca"
    optional: true
