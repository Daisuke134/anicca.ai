# Onboarding Flow Test (Updated for 4-step flow)
# Tests: welcome -> value -> struggles -> notifications -> My Path
# Uses accessibilityIdentifier-based selectors for reliability

appId: ai.anicca.app.ios
name: Onboarding flow
tags:
  - smokeTest
  - onboarding

---
# Clean start - simulate first launch
- clearState
- clearKeychain
- launchApp

# Step 1: Welcome screen - wait for app to fully load
- extendedWaitUntil:
    visible:
      id: "onboarding-welcome-cta"
    timeout: 30000

- tapOn:
    id: "onboarding-welcome-cta"

# Step 2: Value screen
- extendedWaitUntil:
    visible:
      id: "onboarding-value-next"
    timeout: 15000

- tapOn:
    id: "onboarding-value-next"

# Step 3: Struggles screen
- extendedWaitUntil:
    visible:
      id: "onboarding-struggle-staying_up_late"
    timeout: 15000

# Select one struggle (staying_up_late)
- tapOn:
    id: "onboarding-struggle-staying_up_late"

- tapOn:
    id: "onboarding-struggles-next"

# Step 4: Notifications screen
- extendedWaitUntil:
    visible:
      id: "onboarding-notifications-allow"
    timeout: 15000

- tapOn:
    id: "onboarding-notifications-allow"

# Handle iOS notification permission dialog (Japanese: 許可, English: Allow)
- tapOn:
    text: "許可|Allow"
    optional: true

# Dismiss paywall if shown (tap back button)
- tapOn:
    point: "28,78"
    optional: true

# Verify onboarding complete - My Path screen visible (Japanese: マイパス)
- extendedWaitUntil:
    visible:
      text: "マイパス|My Path"
    timeout: 10000

- takeScreenshot: "onboarding-complete"
