# Session Completion Flow Test
# Tests the flow after voice session ends: completion sheet → habit check → celebration animation
# Note: Requires user to be signed in with microphone permission

appId: ai.anicca.app.ios
name: Session completion flow

---
# Launch the app
- launchApp

# Wait for main screen
- assertVisible:
    text: "Talk"
    timeout: 10000

# Start a voice session
- tapOn:
    text: "Consult Anicca"
    optional: true

- tapOn:
    text: "セッションを開始"
    optional: true

# Wait for connection
- assertVisible:
    text: "接続中"
    optional: true
    timeout: 10000

# Wait a bit for session to establish
- sleep: 5000

# End the session
- tapOn:
    text: "終了"
    optional: true

- tapOn:
    text: "End"
    optional: true

# Check for completion sheet
- assertVisible:
    text: "セッションが終了しました"
    optional: true
    timeout: 10000

- assertVisible:
    text: "Session completed"
    optional: true
    timeout: 10000

# Take screenshot for verification
- takeScreenshot:
    path: session_completed

# Check for habit completion button
- assertVisible:
    text: "習慣を完了"
    optional: true

- assertVisible:
    text: "Complete habit"
    optional: true

# Tap habit completion
- tapOn:
    text: "習慣を完了"
    optional: true

- tapOn:
    text: "Complete habit"
    optional: true

# Check for celebration animation/message
- assertVisible:
    text: "おめでとう"
    optional: true
    timeout: 5000

- assertVisible:
    text: "Congratulations"
    optional: true
    timeout: 5000

# Take final screenshot
- takeScreenshot:
    path: celebration_completed

